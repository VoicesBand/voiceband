<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Voices - STL's Premier Classic Band</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="images/logoGTO.jpg" type="image/jpeg">

  <!-- Scoped styles for the carousel shows component (site theme) -->
  <style>
    /* Theme-following container (subtle, dark, no flashy gradients) */
    #live-upcoming { margin-top: 20px; }
    .shows{
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .show-track{width:100%;}
    .show-card{
      display:none;
      align-items:flex-start;
      gap:12px;
      padding:6px 2px;
      opacity:0;
      transform:translateY(4px);
      transition:opacity .2s ease, transform .2s ease;
    }
    .show-card.active{display:flex; opacity:1; transform:translateY(0)}

    .tag{
      font-size:.78rem;
      letter-spacing:.3px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      white-space:nowrap;
      flex:0 0 auto;
    }

    .show-text{line-height:1.25; font-size:clamp(.95rem, .92rem + .2vw, 1.05rem); min-width:0; display:flex; flex-direction:column; gap:4px;}
    .show-text .where{display:block; white-space:normal; overflow:visible;}
    .show-text .time{opacity:.9; font-size:.92em;}
    .show-text a.where{color:#cfc7ff; text-decoration:none; border-bottom:1px dashed rgba(207,199,255,.3);}
    .show-text a.where:hover{text-decoration:underline}

    /* Copy button */
    .copy-btn{
      margin-left:auto;
      flex:0 0 auto;
      align-self:center;
      display:inline-flex; align-items:center; gap:8px;
      height:34px; padding:0 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      color:inherit;
      font:inherit;
      cursor:pointer;
      transition:transform .08s ease, background .15s ease, border-color .15s ease, opacity .2s ease;
    }
    .copy-btn:hover,.copy-btn:focus-visible{
      background:rgba(255,255,255,.08);
      border-color:rgba(207,199,255,.35);
      outline:none;
    }
    .copy-btn:active{transform:translateY(1px)}
    .copy-icon{width:18px;height:18px;display:inline-block;line-height:0}

    .dots{display:flex; gap:6px; align-self:flex-end; margin-top:4px;}
    .dot{width:6px; height:6px; border-radius:50%; background:rgba(255,255,255,.28); box-shadow:0 0 0 1px rgba(255,255,255,.08) inset; opacity:.6;}
    .dot.active{opacity:1; background:#e9ebf0}
    .status{font-size:.85rem; opacity:.8;}

    @media (max-width:360px){ .show-card{padding-right:0} }
    @media (prefers-reduced-motion: reduce){
      .show-card{transition:none}
      .copy-btn{transition:none}
    }
  </style>

  <script>
    const staticData = {
      logoURL: "images/logoGTO.jpg",
      aboutText: `Formerly known as GTO (Good Time Oldies), Voices is a seasoned 4-piece band
      performing around the STL Metro area. Blending live instruments and synthetic backing tracks,
      they cover classic hits from the 60s through the 2000s ‚Äî full of energy, sound, and nostalgia.

      Left (Pat Downs), middle Left (Billy Presnell), Middle right (Dennis Gillam), Right (Jesse Miller).`,
      showsList: ``,
      videoUrls: [
        "https://www.youtube.com/embed/ycCKV5uYKSE",
        "https://www.youtube.com/embed/O-PhaZvzlYw",
        "https://www.youtube.com/embed/-oo8J8FeD-I",
        "https://www.youtube.com/embed/bl5HUp8BnlE"
      ],
      socials: [
        { platform: "Facebook", url: "https://www.facebook.com/voicessing/" },
        { platform: "YouTube", url: "https://youtube.com/@VoicesSTL" },
        { platform: "TikTok", url: "https://www.tiktok.com/@voicesbandofficial" },
        { platform: "Instagram", url: "https://www.instagram.com/voicesmusicofficial/" }
      ]
    };

    const socialIcons = {
      facebook: "https://cdn-icons-png.flaticon.com/512/124/124010.png",
      instagram: "https://cdn-icons-png.flaticon.com/512/2111/2111463.png",
      twitter: "https://cdn-icons-png.flaticon.com/512/124/124021.png",
      youtube: "https://cdn-icons-png.flaticon.com/512/1384/1384060.png",
      tiktok: "https://cdn-icons-png.flaticon.com/512/3046/3046120.png"
    };

    // --- Helpers (shared) ---
    function formatDateString(dateStr) {
      if (!dateStr) return '';
      const dateObj = new Date(dateStr);
      if (isNaN(dateObj.getTime())) return '';
      const monthNames = ["JAN.", "FEB.", "MAR.", "APR.", "MAY", "JUN.", "JUL.", "AUG.", "SEP.", "OCT.", "NOV.", "DEC."];
      const day = dateObj.getDate();
      function ordinalSuffix(n) {
        if (n > 3 && n < 21) return n + "th";
        switch (n % 10) {
          case 1: return n + "st";
          case 2: return n + "nd";
          case 3: return n + "rd";
          default: return n + "th";
        }
      }
      return `${monthNames[dateObj.getMonth()]} ${ordinalSuffix(day)}`;
    }
    function formatTimeForDisplay(timeValue) {
      if (!timeValue) return "Time TBD";
      if (typeof timeValue === 'string') {
        const parsedDate = new Date(timeValue);
        if (!isNaN(parsedDate.getTime())) {
          timeValue = parsedDate;
        } else {
          const trimmed = timeValue.trim();
          return trimmed.length > 0 ? trimmed : "Time TBD";
        }
      }
      if (timeValue instanceof Date && !isNaN(timeValue.getTime())) {
        let hours = timeValue.getHours();
        let minutes = timeValue.getMinutes();
        let ampm = hours >= 12 ? "PM" : "AM";
        hours = hours % 12;
        if (hours === 0) hours = 12;
        let minutesStr = minutes === 0 ? "" : ":" + (minutes < 10 ? "0" + minutes : minutes);
        return `${hours}${minutesStr}${ampm}`;
      }
      return "Time TBD";
    }

    function updatePage() {
      document.getElementById('logo-img').src = staticData.logoURL;
      document.getElementById('about-text').textContent = staticData.aboutText;

      const videoGrid = document.getElementById('video-grid');
      videoGrid.innerHTML = '';
      staticData.videoUrls.forEach(url => {
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.allowFullscreen = true;
        iframe.setAttribute('frameborder', '0');
        videoGrid.appendChild(iframe);
      });

      const socials = document.getElementById('social-links');
      socials.innerHTML = '';
      staticData.socials.forEach(({ platform, url }) => {
        const div = document.createElement('div');
        div.className = 'social-link';
        div.innerHTML = `
          <img src="${socialIcons[platform.toLowerCase()] || ''}" alt="${platform} logo">
          <a href="${url}" target="_blank">${url}</a>
        `;
        socials.appendChild(div);
      });
    }

    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId.toLowerCase());
      if (section) section.scrollIntoView({ behavior: 'smooth' });
    }

    // ---- Upcoming Shows (carousel) below the image carousel ----
    const webAppURL = "https://script.google.com/macros/s/AKfycbyDTA_oy4BqqP-3ZeAkyV7UPugAcJ-YCbhwxCMZRtGyLDzoCa_pWMRVJAy2mdScDLr3wQ/exec";
    const POLL_MS = 15000;
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const today = new Date(); today.setHours(0,0,0,0);

    let showsEl, trackEl, dotsEl, statusEl;

    function normalize(raw){
      return (raw || []).map(s => ({
        date:    s.Date,
        time:    s.Time,
        title:   s.Location || "Show", // used for display
        city:    s.City || "",
        map:     s.Map || "",
        Location: s.Location || ""     // raw Location for copy (treat as address)
      }))
      .filter(s => {
        if (!s.date) return false;
        const d = new Date(s.date); d.setHours(0,0,0,0);
        return d >= today;
      })
      .sort((a,b) => new Date(a.date) - new Date(b.date));
    }

    function tryAddressFromMap(mapUrl){
      try{
        if (!mapUrl) return "";
        const u = new URL(mapUrl);

        // 1) ?q=...
        const q = u.searchParams.get('q');
        if (q) return decodeURIComponent(q).replace(/\+/g,' ').trim();

        // 2) ?query=...
        const query = u.searchParams.get('query');
        if (query) return decodeURIComponent(query).replace(/\+/g,' ').trim();

        // 3) /maps/place/<addr>  or /maps/search/<addr>
        const path = decodeURIComponent(u.pathname);
        const m = path.match(/\/maps\/(?:place|search)\/([^/]+)/i);
        if (m && m[1]) return m[1].replace(/\+/g,' ').replace(/,/g, ', ').trim();
      }catch(e){}
      return "";
    }

    // Build ONLY the address text (no date/time/venue). Use Location as address.
    function buildAddressOnly(s){
      const addr = (s.Location && s.Location.trim()) || tryAddressFromMap(s.map);
      return addr || "";
    }

    function clipboardCopy(text){
      if (navigator.clipboard && navigator.clipboard.writeText) {
        return navigator.clipboard.writeText(text);
      }
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } finally { document.body.removeChild(ta); }
      return Promise.resolve();
    }

    function hash(obj){ return JSON.stringify(obj); }

    let cards = [];
    let dots  = [];
    let idx   = 0;
    let rotateTimer = null;
    let pollTimer   = null;
    let lastHash    = "";

    function clearChildren(node){ while(node.firstChild) node.removeChild(node.firstChild); }
    function activate(i){
      cards.forEach((c,j)=>c.classList.toggle('active', j===i));
      dots.forEach((d,j)=>d.classList.toggle('active', j===i));
    }
    function startRotate(){
      if (prefersReduced || !cards.length) return;
      stopRotate();
      rotateTimer = setInterval(()=>{ idx = (idx + 1) % cards.length; activate(idx); }, 4000);
    }
    function stopRotate(){ if (rotateTimer){ clearInterval(rotateTimer); rotateTimer = null; } }

    function render(upcoming){
      const currentVenue = cards[idx]?.querySelector('.where strong')?.textContent || null;

      clearChildren(trackEl);
      clearChildren(dotsEl);
      cards = []; dots = [];

      upcoming.forEach((s)=>{
        const card = document.createElement('div');
        card.className = 'show-card';

        const tag = document.createElement('div');
        tag.className = 'tag';
        tag.textContent = `${new Date(s.date).toLocaleDateString(undefined,{ weekday:'short' })} ‚Ä¢ ${formatDateString(s.date)}`;

        const text = document.createElement('div'); text.className = 'show-text';

        const where = document.createElement(s.map ? 'a' : 'span');
        where.className = 'where';
        if (s.map){ where.href = s.map; where.target = "_blank"; where.rel = "noopener noreferrer"; }
        where.title = s.city ? `${s.title} ‚Äî ${s.city}` : s.title;
        where.innerHTML = `<strong>${s.title}</strong>${s.city ? ` ‚Äî ${s.city}` : ''}`;

        const time = document.createElement('div');
        time.className = 'time';
        time.textContent = formatTimeForDisplay(s.time);

        // Copy Address button (address ONLY from Location/Map)
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.type = 'button';
        copyBtn.setAttribute('aria-label','Copy address');
        copyBtn.innerHTML = `
          <span class="copy-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
              <rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"></rect>
              <rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" opacity=".7"></rect>
            </svg>
          </span>
          Copy
        `;
        copyBtn.addEventListener('click', async () => {
          const addressOnly = buildAddressOnly(s);
          if (!addressOnly){
            alert('No address available to copy for this event yet.');
            return;
          }
          try {
            await clipboardCopy(addressOnly);
            copyBtn.textContent = 'Copied!';
            setTimeout(()=>{ copyBtn.innerHTML = `
              <span class="copy-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
                  <rect x="9" y="9" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2"></rect>
                  <rect x="5" y="3" width="10" height="12" rx="2" stroke="currentColor" stroke-width="2" opacity=".7"></rect>
                </svg>
              </span>
              Copy
            `; }, 1200);
          } catch(e){
            alert('Could not copy. Long-press to copy the address manually:\n\n' + addressOnly);
          }
        });

        text.appendChild(where); 
        text.appendChild(time);
        card.appendChild(tag); 
        card.appendChild(text);
        card.appendChild(copyBtn);

        trackEl.appendChild(card);

        const dot = document.createElement('span'); dot.className = 'dot'; dotsEl.appendChild(dot);

        cards.push(card); dots.push(dot);
      });

      const newIndex = currentVenue ? cards.findIndex(c => c.querySelector('.where strong')?.textContent === currentVenue) : 0;
      idx = newIndex >= 0 ? newIndex : 0;
      activate(idx);
      startRotate();
    }

    async function fetchShows(){
      const res = await fetch(webAppURL + "?_=" + Date.now(), { cache: "no-store", mode: "cors" });
      if (!res.ok) throw new Error("Apps Script fetch failed: " + res.status);
      const data = await res.json();
      return normalize(data);
    }

    async function refresh(){
      if (document.hidden) return;
      try{
        const upcoming = await fetchShows();
        const h = hash(upcoming);
        if (h !== lastHash){
          lastHash = h;
          statusEl.textContent = upcoming.length ? "" : "No upcoming shows yet ‚Äî check back soon!";
          if (!upcoming.length){
            stopRotate();
            trackEl.innerHTML = `<div class="show-card active">
              <div class="tag">‚Äî ‚Ä¢ ‚Äî</div>
              <div class="show-text"><span class="where">No upcoming shows yet</span><div class="time"></div></div>
              <button class="copy-btn" type="button" disabled>Copy</button>
            </div>`;
            while(dotsEl.firstChild) dotsEl.removeChild(dotsEl.firstChild);
            cards = Array.from(trackEl.children);
            dots  = [];
          } else {
            render(upcoming);
          }
        }
      } catch(err){
        console.error("[Index] fetch shows error:", err);
        statusEl.textContent = "Couldn‚Äôt load shows. Check connection or Apps Script.";
      }
    }

    function startPoll(){ if (!pollTimer) pollTimer = setInterval(refresh, POLL_MS); }
    function stopPoll(){ if (pollTimer){ clearInterval(pollTimer); pollTimer = null; } }

    // ---- Image banner carousel (above shows) ----
    const carouselImages = [
      'images/1.JPG','images/2.JPG','images/3.JPG','images/4.JPG','images/5.JPG',
      'images/6.JPG','images/7.JPG','images/8.JPG','images/9.JPG','images/10.JPG'
    ];
    let currentImgIndex = 0;
    function cycleCarousel() {
      const img = document.getElementById('carousel-img');
      currentImgIndex = (currentImgIndex + 1) % carouselImages.length;
      img.src = carouselImages[currentImgIndex];
    }

    window.onload = () => {
      updatePage();

      // start image carousel
      setInterval(cycleCarousel, 4000);

      // init shows carousel (DOM refs now exist)
      showsEl  = document.getElementById('shows');
      trackEl  = document.getElementById('showTrack');
      dotsEl   = document.getElementById('dots');
      statusEl = document.getElementById('showsStatus');

      (async function initShows(){
        await refresh();

        showsEl.addEventListener('mouseenter', stopRotate);
        showsEl.addEventListener('mouseleave', startRotate);
        showsEl.addEventListener('focusin',  stopRotate);
        showsEl.addEventListener('focusout', startRotate);

        // Swipe
        let x0 = null;
        showsEl.addEventListener('touchstart', e => { x0 = e.touches[0].clientX; }, {passive:true});
        showsEl.addEventListener('touchend', e => {
          if (x0 == null || !cards.length) return;
          const dx = e.changedTouches[0].clientX - x0;
          if (Math.abs(dx) > 30){
            idx = (idx + (dx < 0 ? 1 : -1) + cards.length) % cards.length;
            activate(idx);
          }
          x0 = null;
        });

        // Keyboard
        showsEl.tabIndex = 0;
        showsEl.addEventListener('keydown', e => {
          if (!cards.length) return;
          if (e.key === 'ArrowRight'){ idx = (idx + 1) % cards.length; activate(idx); e.preventDefault(); }
          if (e.key === 'ArrowLeft'){  idx = (idx - 1 + cards.length) % cards.length; activate(idx); e.preventDefault(); }
        });

        // Poll for updates, pause when tab hidden
        document.addEventListener('visibilitychange', () => {
          if (document.hidden) { stopPoll(); stopRotate(); }
          else { startPoll(); startRotate(); refresh(); }
        });
        startPoll();
      })();

      // Booking + Newsletter (unchanged)
      const form = document.getElementById("booking-form");
      const scriptURL = "https://script.google.com/macros/s/AKfycbyDTA_oy4BqqP-3ZeAkyV7UPugAcJ-YCbhwxCMZRtGyLDzoCa_pWMRVJAy2mdScDLr3wQ/exec";

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        fetch(scriptURL, {
          method: "POST",
          body: new URLSearchParams(formData),
        })
        .then(res => res.json())
        .then(data => {
          if (data.result === "success") {
            alert("‚úÖ Booking submitted successfully!");
            form.reset();
          } else {
            alert("‚ùå Error: " + data.message);
          }
        })
        .catch(error => {
          console.error("Error sending booking:", error);
          alert("‚ùå Network or system error occurred.");
        });
      });

      const newsletterBtn = document.getElementById("newsletter-btn");
      newsletterBtn.addEventListener("click", () => {
        const email = prompt("Enter your email to sign up for the newsletter:");
        if (!email || !email.includes("@")) return alert("Invalid email.");
        fetch(scriptURL, {
          method: "POST",
          body: new URLSearchParams({ email, newsletter: "true" })
        })
        .then(res => res.json())
        .then(data => {
          if (data.result === "success") {
            alert("‚úÖ Thanks for signing up! A confirmation email has been sent.");
          } else {
            alert("‚ùå Error: " + data.message);
          }
        })
        .catch(err => {
          console.error(err);
          alert("‚ùå Failed to sign up.");
        });
      });
    };
  </script>
</head>
<body>

  <header class="site-header">
    <div class="logo">
      <img id="logo-img" src="images/logoGTO.jpg" alt="Voices Logo" />
    </div>
    <nav class="nav-scroll">
      <div class="nav-bar">
        <button onclick="scrollToSection('about')">about</button>
        <button onclick="scrollToSection('live-upcoming')">shows</button>
        <button onclick="scrollToSection('gallery')">gallery</button>
        <button onclick="scrollToSection('booking')">booking</button>
        <button onclick="scrollToSection('socials-section')">socials</button>
        <a href="admin.html" class="admin-link">Admin</a>
      </div>
    </nav>
  </header>

  <header class="hero">
    <img src="images/banner.jpg" alt="Voices Band Banner" />
  </header>

  <section id="about">
    <h2>üé§ Voices</h2>
    <p id="about-text"></p>
  </section>

  <!-- Image carousel -->
  <div id="carousel">
    <img id="carousel-img" src="images/1.JPG" alt="Band Carousel" />
  </div>

  <!-- Upcoming Shows BELOW the image carousel -->
  <section id="live-upcoming" aria-label="Live Upcoming Shows">
    <h3 style="color:#00bfff; margin: 16px 0 8px;">Live Upcoming Shows</h3>
    <section class="shows" id="shows" aria-label="Upcoming shows" aria-live="polite">
      <div class="show-track" id="showTrack"></div>
      <div class="dots" id="dots" aria-hidden="true"></div>
      <div class="status" id="showsStatus">Loading upcoming shows‚Ä¶</div>
    </section>
  </section>

  <section id="gallery">
    <h2>Media Gallery</h2>
    <div class="video-grid" id="video-grid"></div>
    <a href="https://www.youtube.com/@VoicesSTL" target="_blank" class="btn">More Videos</a>
  </section>

  <section id="booking">
    <h2>Book Voices</h2>
    <form id="booking-form">
      <input type="text" name="name" placeholder="Your Name" required />
      <input type="email" name="email" placeholder="Your Email" required />
      <input type="text" name="date" placeholder="Requested Date" />
      <input type="text" name="location" placeholder="Event Location" />
      <textarea name="message" placeholder="Additional Info or Questions"></textarea>
      <button type="submit">Submit Booking</button>
    </form>
  </section>

  <section id="newsletter">
    <h2>üìß Newsletter</h2>
    <button id="newsletter-btn">Sign Up for Updates</button>
  </section>

  <section id="socials-section" class="socials">
    <h2>Socials</h2>
    <div id="social-links"></div>
  </section>

</body>
</html>
